# 4.3.1 νΈλμ­μ… (transaction)

μ›μμ„±, μΌκ΄€μ„±, λ…λ¦½μ„±, μ§€μ†μ„± μ΄λΌλ” νΉμ§•μ„ λ¬¶μ–΄ `ACID` λΌκ³  λ¶€λ¥Έλ‹¤. 

### | μ›μμ„±(atomicity)

"all or nothing"

νΈλμ­μ…κ³Ό κ΄€λ ¨λ μΌμ΄ λ¨λ‘ μν–‰λμ—κ±°λ‚ λμ§€μ•λ” κ²ƒμ„ μλ―Έν•λ‹¤. 

λ§μ•½ νΈλμ­μ…μ„ μ»¤λ°‹ν–λ”λ° λ¬Έμ κ°€ λ°μƒν•μ—¬ λ΅¤λ°±ν•λ” κ²½μ°, λ°μƒν• λ³€κ²½μ‚¬ν•­μ„ μ·¨μ†ν•κ³  μ΄ν›„μ μΏΌλ¦¬λ¥Ό λ¨λ‘ μν–‰ν•μ§€ μ•μμ„ λ³΄μ¥ν•λ‹¤. 

> κΈμµμ„λΉ„μ¤μ—μ„ νΉν μ¤‘μ”ν• νΉμ§•μ΄μ£  .     
> μμ‹μ—μ„μ™€ κ°™μ΄ 1. μ”κ³ μ΅°ν A: 1000, B: 0 2. A &rarr; B 500λ§μ› μ†΅κΈ 3. B &rarr; A 500λ§μ› μ†΅κΈ      
> μΌ λ•, 2.κΉμ§€λ§ μν–‰λκ³  λ΅¤λ°±μ²λ¦¬(μ‘μ—…μ·¨μ†) μ‹,  3.μΏΌλ¦¬κ°€ μν–‰λμ§€ μ•κ³  λ‹¤μ‹ μ²μμ μƒνƒμΈ  A: 1000, B: 0λ΅ λμ•„κ°€λ” κ²ƒμ„ μλ―Έν•©λ‹λ‹¤.    

μ™Έλ¶€ APIλ΅ λ°μλ λ‚΄μ©μ€ λ΅¤λ°±ν•κΈ° μ–΄λ µκΈ° λ•λ¬Έμ— νΈλμ­μ… λ‹¨μ„λ΅ μ—¬λ¬ λ΅μ§λ“¤μ„ λ¬¶μ„ λ–Ό μ™Έλ¶€ APIλ¥Ό νΈμ¶ν•λ” κ²ƒμ΄ μμΌλ©΄ μ•λλ‹¤. 

<b> _μ»¤λ°‹κ³Ό λ΅¤λ°±_ </b>

`μ»¤λ°‹(commit)`μ€ μ—¬λ¬ μΏΌλ¦¬κ°€ μ„±κ³µμ μΌλ΅ μ²λ¦¬λμ—λ‹¤κ³  ν™•μ •ν•λ” λ…λ Ήμ–΄μ΄λ‹¤. 

νΈλμ­μ… λ‹¨μ„λ΅ μν–‰λλ©°, λ³€κ²½λ λ‚΄μ©μ΄ λ¨λ‘ μκµ¬μ μΌλ΅ μ €μ¥λλ” κ²ƒμ„ λ§ν•λ‹¤. 

"μ»¤λ°‹μ΄ μν–‰λμ—λ‹¤"λ” μλ―Έλ” "ν•λ‚μ νΈλμ­μ…μ΄ μ„±κ³µμ μΌλ΅ μν–‰λμ—λ‹¤"λ” μλ―Έμ™€ λ™μΌν•λ‹¤. 

`λ΅¤λ°±(rollback)`μ΄λ€ νΈλμ­μ…μΌλ΅ μ²λ¦¬ν• ν•λ‚μ λ¬¶μ κ³Όμ •μ„ μΌμ–΄λ‚κΈ° μ „μΌλ΅ λλ¦¬λ” μΌ(μ‘μ—… μ·¨μ†)λ¥Ό μλ―Έν•λ‹¤.

μ΄λ¬ν• μ»¤λ°‹κ³Ό λ΅¤λ°± λ•μ— λ°μ΄ν„°μ λ¬΄κ²°μ„±μ΄ λ³΄μ¥λλ‹¤. 

```
π¤“ λ¬΄κ²°μ„±(integrity) μ΄λ€ ? 
λ°μ΄ν„°μ μ •ν™•μ„±κ³Ό μΌκ΄€μ„±μ„ μ μ§€ν•κ³  λ³΄μ¦ν•λ” κ²ƒμ„ κ°€λ¦¬ν‚¨λ‹¤. 
```

<b> _νΈλμ­μ… μ „ν(transaction propagation)_ </b>

μ—¬λ¬ νΈλμ­μ… κ΄€λ ¨ λ©”μ„λ“μ νΈμ¶μ„ ν•λ‚μ νΈλμ­μ…μ— λ¬¶μ΄λ„λ΅ ν•λ” κ²ƒμ„ λ§ν•λ‹¤. 

μ΄λ¥Ό μ„ν•΄ springμ—μ„λ” @Transactional μ–΄λ…Έν…μ΄μ…μ„ μ κ³µν•λ‹¤. 

```java

```

<br />

### | μΌκ΄€μ„± (consistency)

ν—μ©λ λ°©μ‹μΌλ΅λ§ λ°μ΄ν„°λ¥Ό λ³€κ²½ν•΄μ•Ό ν•λ” κ²ƒμ„ μλ―Έν•λ‹¤. 

μ¦‰, μΌκ΄€μ„±μ„ κΉ¨λ” λ°μ΄ν„°μ— λ€ν•΄μ„λ” νΈλμ­μ…μ΄ μ„±κ³µμ μΌλ΅ μ‹¤ν–‰λμ§€ μ•μ•„μ•Ό ν•λ‹¤. 

> 'λ¨λ“  κµ­λ―Όμ€ λ°λ“μ‹ μ£Όλ―Όλ²νΈκ°€ μμ–΄μ•Ό ν•λ‹¤' λ” DB μ μ•½μ΄ μμ„ λ•,       
> 1. μ£Όλ―Όλ²νΈκ°€ μ—†λ” μƒλ΅μ΄ κµ­λ―Όμ„ λ“±λ΅ν•λ” μΏΌλ¦¬           
> 2. κΈ°μ΅΄μ— λ“±λ΅λ μ£Όλ―Όλ²νΈλ¥Ό μ‚­μ ν•λ” μΏΌλ¦¬         
> λ” νΈλμ­μ…μ μΌκ΄€μ„±μ„ μ„λ°ν•λ” μΏΌλ¦¬μ΄λ―€λ΅, μ‹¤ν–‰λμ§€ μ•λ”λ‹¤.    

<br />

### | κ²©λ¦¬μ„± (isolation)

νΈλμ­μ… μν–‰ μ‹ μ„λ΅ λΌμ–΄λ“¤μ§€ λ»ν•λ” κ²ƒμ„ μλ―Έν•λ‹¤. 

λ³µμμ λ³‘λ ¬ νΈλμ­μ…μ€ μ„λ΅ κ²©λ¦¬λμ–΄ λ§μΉ μμ°¨μ μΌλ΅ μ‹¤ν–‰λλ” κ²ƒ μ²λΌ μ‘λ™λμ–΄μ•Ό ν•κ³ , DBλ” μ—¬λ¬ μ‚¬μ©μκ°€ κ°™μ€ λ°μ΄ν„°μ— μ ‘κ·Όν•  μ μμ–΄μ•Ό ν•λ‹¤. 

> μμ°¨μ μΌλ΅ μ²λ¦¬ν•  μλ” μκ² μ§€λ§ μ„±λ¥μ΄μκ°€ μƒκΈΈ μ μκ² μ£ .. ? 

κ²©λ¦¬μ„±μ€ μ—¬λ¬ κ°μ κ²©λ¦¬ μμ¤€μΌλ΅ λ‚λ„μ–΄ κ° νΈλμ­μ…μ λ…λ¦½μ„±μ„ λ³΄μ¥ν•λ” κ²ƒμ΄λ‹¤. 

<b> _κ²©λ¦¬μμ¤€_ </b>

μΌλ°μ μΌλ΅ μ„λ΅ κ°μλ΅ νΈλμ­μ…κ°„ κ²©λ¦¬μ„±μ€ λ†’κ³ , λ™μ‹μ„±μ΄ λ‚®μΌλ©° μ„±λ¥μ΄ λ–¨μ–΄μ§„λ‹¤. 

| μμ¤€ | νΉμ§• | 
| --- | --- | 
| SERIALIZABLE | κ°€μ¥ μ—„κ²©ν• κ²©λ¦¬μμ¤€. νΈλμ­μ…μ„ μμ°¨μ μΌλ΅ μ§„ν–‰μ‹ν‚¤λ” κ²ƒμ„ μλ―Έν•λ‹¤. μ—¬λ¬ νΈλμ­μ…μ΄ λ™μ‹μ— κ°™μ€ ν–‰μ— μ ‘κ·Όν•  μ μ—†λ‹¤. κµμ°© μƒνƒκ°€ μΌμ–΄λ‚  ν™•λ¥ μ΄ ν¬λ©°, μ„±λ¥μ΄ κ°€μ¥ λ–¨μ–΄μ§„λ‹¤.| 
| REPEATABLE READ | ν•λ‚μ νΈλμ­μ…μ΄ μ‘μ—…μ„ μν–‰ μ¤‘μΌλ•, λ‹¤λ¥Έ νΈλμ­μ…μ΄ μμ •ν•  μ μ—†λ„λ΅ λ§‰μ•„μ¤€λ‹¤. κ·Έλ¬λ‚ μƒλ΅μ΄ ν–‰μ„ μ¶”κ°€ν•λ” κ²ƒμ„ λ§‰μ§€λ” μ•κΈ° λ•λ¬Έμ—, μ΄ν›„ μ¶”κ°€λ ν–‰μ΄ λ°κ²¬λ  μ μλ‹¤. |
| READ COMMITTED | κ°€μ¥ λ§μ΄ μ‚¬μ©(default μ„¤μ •)λλ” κ²©λ¦¬μμ¤€μ΄λ‹¤. μ»¤λ°‹μ΄ μ™„λ£λ λ°μ΄ν„°λ§ μ΅°νλ¥Ό ν—μ©ν•λ‹¤. ν•λ‚μ νΈλμ­μ…μ΄ μ‘μ—…μ„ μν–‰ν•  λ•, λ‹¤λ¥Έ νΈλμ­μ…μ΄ μμ •ν•  μ μλ‹¤. λ”°λΌμ„ κ°™μ€ ν–‰μ„ λ‹¤μ‹ μ½μ„ λ• λ‹¤λ¥Έ λ‚΄μ©μ΄ λ°κ²¬λ  μ μλ‹¤. |
| READ UNCOMMITED | κ°€μ¥ λ‚®μ€ κ²©λ¦¬ μμ¤€μΌλ΅, ν•λ‚μ νΈλμ­μ…μ΄ μ»¤λ°‹λκΈ° μ΄μ „μ— λ‹¤λ¥Έ νΈλμ­μ…μ΄ λ…Έμ¶ λλ‹¤. μ†λ„λ” κ°€μ¥ λΉ λ¥΄λ‚, λ°μ΄ν„° λ¬΄κ²°μ„±μ„ μ„ν•΄ μ‚¬μ©ν•μ§€ μ•λ” κ²ƒμ„ κ¶μ¥ν•λ‹¤. |

<b> _κ²©λ¦¬μμ¤€μ— λ”°λΌ λ°μƒν•λ” ν„μƒ_ </b>

κ° λ‹¨κ³„λ§λ‹¤ ν¬ν…€λ¦¬λ“ / λ°λ³µ κ°€λ¥ν•μ§€ μ•μ€ μ΅°ν / λ”ν‹° λ¦¬λ“ ν„μƒμ΄ λ‚νƒ€λ‚  μ μλ‹¤. 

| ν„μƒ | λ°μƒ μμ¤€ | μ„¤λ… | 
| --- | --- | --- | 
| ν¬ν…€λ¦¬λ“ | REPEATABLE_READ, READ_COMMITED, READ_UNCOMMITED | ν• νΈλμ­μ… λ‚΄μ—μ„ λ™μΌν• μΏΌλ¦¬λ¥Ό λ³΄λƒμ„ λ• ν•΄λ‹Ή μ΅°ν κ²°κ³Όκ°€ λ‹¤λ¥Έ κ²½μ°λ¥Ό μλ―Έν•λ‹¤. (λ‹¤λ¥Έ ν–‰μ΄ μ„ νƒλ  μ λ„ μμ) | 
| λ°λ³µ κ°€λ¥ν•μ§€ μ•μ€ μ΅°ν | READ_COMMITED, READ_UNCOMMITED | ν• νΈλμ­μ… λ‚΄μ κ°™μ€ ν–‰μ— λ‘ λ² μ΄μƒ μ΅°νκ°€ λ°μƒν–μ„ λ•, κ·Έ κ°’μ΄ λ‹¤λ¥Έ κ²½μ°λ¥Ό μλ―Έν•λ‹¤. | 
| λ”ν‹°λ¦¬λ“ | READ_UNCOMMITED | λ°λ³µ κ°€λ¥ν•μ§€ μ•μ€ μ΅°νμ™€ μ μ‚¬ν•λ‹¤. ν• νΈλμ­μ…μ΄ μ‹¤ν–‰ μ¤‘μΌλ• λ‹¤λ¥Έ νΈλμ­μ…μ— μν•΄ μμ •λμ—μ§€λ§ μ•„μ§ 'μ»¤λ°‹λμ§€ μ•μ€' ν–‰μ λ°μ΄ν„°λ¥Ό μ½μ„ μ μμ„ λ• λ°μƒν•λ‹¤. | 

<br />

### | μ§€μ†μ„± (durability)

μ„±κ³µμ μΌλ΅ μν–‰λ νΈλμ­μ…μ€ μμ›ν λ°μλμ–΄μ•Ό ν•¨μ„ μλ―Έν•λ‹¤. 

μ΄λ” λ°μ΄ν„°λ² μ΄μ¤μ— μ‹μ¤ν… μ¥μ• κ°€ λ°μƒν•΄λ„ μ›λ μƒνƒλ΅ λ³µκµ¬ν•λ” νλ³µ κΈ°λ¥μ΄ μμ–΄μ•Ό ν•¨μ„ μλ―Έν•λ‹¤. 

```
π¤“ μ²΄ν¬μ„¬ μ΄λ€ ? 
μ¤‘λ³µ κ²€μ‚¬μ ν• ν•νƒλ΅, μ¤λ¥ μ •μ •μ„ ν†µν•΄ μ†΅μ‹ λ μλ£μ λ¬΄κ²°μ„±μ„ λ³΄νΈν•λ” λ‹¨μν• λ°©λ²•μ΄λ‹¤. 
```

```
π¤“ μ €λ„λ§ μ΄λ€ ?
νμΌ μ‹μ¤ν… λλ” λ°μ΄ν„°λ² μ΄μ¤ μ‹μ¤ν…μ— λ³€κ²½ μ‚¬ν•­μ„ λ°μν•κΈ° μ „μ— λ΅κΉ…ν•λ” κ²ƒμ„ λ§ν•λ‹¤. 
λ‹¤μ‹ λ§ν•΄ νΈλμ­μ… λ“± λ³€κ²½ μ‚¬ν•­μ— λ€ν• λ΅κ·Έλ¥Ό λ‚¨κΈ°λ” κ²ƒμ΄λ‹¤. 
```

