# 4.5.4 인덱스 최적화 기법

MongoDB를 기반으로 인덱스를 최적화 하는 방법을 알아보자. 

### 1. 인덱스는 비용이다. 

- 인덱스는 2번 탐색하도록 한다. (인덱스 리스트 -> 컬렉션 순)           
> 찾아보기에서 한번 훑고 -> 해당 페이지 가서 한번 훑고 이런식으로 이해 ... !            
- 컬렉션이 수정되었을 때 인덱스도 수정한다. 
- 쿼리에 있는 필드에 인덱스를 무작정 다 설정하지 않도록 한다. 
- 컬렉션에서 가져와야 하는 양이 많을수록 인덱스를 사용하는 것은 비효율적이다.            
> 이름이 김소연이고 성별이 여자인 사람을 모두 불러와야 하는경우, 굳이 인덱싱을 해놓더라도 특정 인물을 찾으려면 여러 조건들을 더 고려해서 찾아야한다... 이 경우 인덱스 필요 없음 ..              

<br />>

### 2. 항상 테스팅하라. 

인덱스 최적화기법은 서비스의 특징에 따라 달라지므로, 각 특성에 맞게 생성 및 테스팅 하는 것이 중요하다. 

`explain()` 함수를 통해 인덱스를 생성하고 쿼리를 보낸 후 테스팅을 하며 걸리는 시간을 최소화해야 한다. 

<br />

### 3. 복합 인덱스는 '같음 > 정렬 > 다중값 > 카디널리티' 순이다. 

보통 여러 필드를 기반으로 조회 시 복합 인덱스를 생성한다. 

이 인덱스를 생성할 때는 순서가 있고, 생성 순서에 따라 인덱스 성능이 달라지므로 위의 순서를 지키는 것을 권장한다. 

1. 어떠한 값과 같음을 비교하는 == 이나 equal 이라는 쿼리
2. 정렬에 쓰이는 필드 
3. 다중 값을 출력해야 하는 필드 (부등호 < 이나 >  사용 시)
4. 유니크한 값의 정도를 카디널리티라고 한다. 이 카디널리티가 높은 순서를 기반으로 인덱스를 생성해야 한다.     
> {name} {useid}가 있을 경우, {userid} 필드에 대한 인덱스를 먼저 생성해야 한다. 